# ============================================
# 小红书 (XHS) 平台爬虫配置
# ============================================
#
# 使用：docker-compose -f docker-compose.yml -f docker-compose.xhs.yml up -d
#
# ============================================

# YAML 锚点 - 复用配置
x-xhs-crawler-base: &xhs-crawler-base
  image: ghcr.io/${GITHUB_USERNAME}/crawler:latest
  restart: unless-stopped
  labels:
    - "com.centurylinklabs.watchtower.enable=true"
    - "com.centurylinklabs.watchtower.stop-timeout=60s"
    - "platform=xhs"  # 平台标签
  networks:
    - crosshot

services:
  # ============================================
  # 小红书 Crawler 实例
  # ============================================

  # 美妆护肤
  crawler-xhs-beauty:
    <<: *xhs-crawler-base
    container_name: crawler-xhs-beauty
    volumes:
      - ./data/xhs/beauty:/app/data
      - ./logs/xhs/beauty:/app/logs
    environment:
      - ENV=production
      - LOG_LEVEL=INFO
      - PLATFORM=xhs
      - KEYWORDS=美妆,护肤,化妆,彩妆
      - MAX_RESULTS=100
      - INTERVAL=3600  # 1 小时

  # 旅行攻略
  crawler-xhs-travel:
    <<: *xhs-crawler-base
    container_name: crawler-xhs-travel
    volumes:
      - ./data/xhs/travel:/app/data
      - ./logs/xhs/travel:/app/logs
    environment:
      - ENV=production
      - LOG_LEVEL=INFO
      - PLATFORM=xhs
      - KEYWORDS=旅行,旅游,攻略,民宿
      - MAX_RESULTS=100
      - INTERVAL=3600

  # 穿搭时尚
  crawler-xhs-fashion:
    <<: *xhs-crawler-base
    container_name: crawler-xhs-fashion
    volumes:
      - ./data/xhs/fashion:/app/data
      - ./logs/xhs/fashion:/app/logs
    environment:
      - ENV=production
      - LOG_LEVEL=INFO
      - PLATFORM=xhs
      - KEYWORDS=穿搭,时尚,搭配,OOTD
      - MAX_RESULTS=80
      - INTERVAL=7200  # 2 小时

  # 美食探店
  crawler-xhs-food:
    <<: *xhs-crawler-base
    container_name: crawler-xhs-food
    volumes:
      - ./data/xhs/food:/app/data
      - ./logs/xhs/food:/app/logs
    environment:
      - ENV=production
      - LOG_LEVEL=INFO
      - PLATFORM=xhs
      - KEYWORDS=美食,探店,餐厅,甜品
      - MAX_RESULTS=80
      - INTERVAL=7200

  # ============================================
  # 小红书专属 Watchtower
  # ============================================
  watchtower-xhs:
    image: containrrr/watchtower:latest
    container_name: watchtower-xhs
    restart: unless-stopped
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      # 只监控小红书平台的 crawler
      - WATCHTOWER_LABEL_ENABLE=true
      - WATCHTOWER_LABEL_TAKE_IMAGE=platform=xhs

      # 小红书更新相对慢，每 30 分钟检查
      - WATCHTOWER_POLL_INTERVAL=1800

      # 基础配置
      - WATCHTOWER_CLEANUP=true
      - WATCHTOWER_INCLUDE_RESTARTING=true
      - WATCHTOWER_INCLUDE_STOPPED=false
      - WATCHTOWER_DEBUG=false
    networks:
      - crosshot

# ============================================
# 添加更多小红书 Crawler
# ============================================
#
# 复制上面的配置，修改关键字段即可
#
# 示例：
#
#   crawler-xhs-fitness:
#     <<: *xhs-crawler-base
#     container_name: crawler-xhs-fitness
#     volumes:
#       - ./data/xhs/fitness:/app/data
#       - ./logs/xhs/fitness:/app/logs
#     environment:
#       - PLATFORM=xhs
#       - KEYWORDS=健身,减肥,瑜伽,运动
#       - MAX_RESULTS=50
#       - INTERVAL=10800  # 3 小时
#
# ============================================
